<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>All Posts</title>
    <link rel="stylesheet" href="/css/tooplate-style.css">
</head>
<body>
<div class="navigation-bar">
    <div class="nav-menu">
        <a href="#" th:href="@{/users/sell-posts}" class="view-my-posts-btn">View My Posts</a>
        <a href="#" th:href="@{/users/favorite-posts}" class="view-my-posts-btn">View My  Favourite Posts</a>

    </div>
    <div class="nav-actions">
        <a th:href="@{/users/profile}" class="btn btn-primary">View Profile</a>
        <a th:href="@{/users/logout}" class="logout-btn">Logout</a>
    </div>
</div>

    <div class="content">
                <form th:action="@{/users/all-posts}" method="get" class="filter-form">
                    <select name="postType">
                        <option value="ALL" th:selected="${postType == 'ALL'}">All Posts</option>
                        <option value="SELL" th:selected="${postType == 'SELL'}">Sell Posts</option>
                        <option value="FREE" th:selected="${postType == 'FREE'}">Free Posts</option>
                        <option value="SEEKING" th:selected="${postType == 'SEEKING'}">Seeking Posts</option>
                    </select>

                    <select name="categoryId">
                        <option value="">All Categories</option>
                        <option th:each="category : ${categories}"
                                th:value="${category.id}"
                                th:text="${category.name}"
                                th:selected="${category.id == selectedCategoryId}">
                        </option>
                    </select>

                    <select name="courseId">
                        <option value="">All Courses</option>
                        <option th:each="course : ${courses}"
                                th:value="${course.id}"
                                th:text="${course.courseName}"
                                th:selected="${course.id == selectedCourseId}">
                        </option>
                    </select>

                    <button type="submit" class="btn btn-primary">Filter Posts</button>
                </form>
            </div>
        </div>

        <div th:if="${posts.isEmpty()}" class="tm-text-center">
            <p>No posts found.</p>
        </div>

        <div th:unless="${posts.isEmpty()}" class="post-grid">
            <div th:each="post : ${posts}" class="post-card">
                <div class="post-header">
                    <span class="post-author" th:text="${post.author.username}">Username</span>
                    <span class="post-date" th:text="${#dates.format(post.created, 'dd.MM.yyyy HH:mm')}">Date</span>
                </div>

                <img th:if="${post.imageUrl != null}"
                     th:src="${post.imageUrl}"
                     alt="Post Image"
                     class="post-image">

                <div class="post-details">
                    <h3 th:text="${post.title}">Post Title</h3>
                    <p th:text="${post.content}">Post Description</p>
                    <p class="post-price" th:if="${post.price > 0}">
                        Price: <span th:text="${post.price}">0</span> EUR
                    </p>
                    <p>Category: <span th:text="${post.category.name}">Category</span></p>
                    <p>Course: <span th:text="${post.author.course?.courseName ?: 'N/A'}">Course</span></p>

                    <div class="post-actions">
                        <form th:action="@{/users/add-to-favorites}" method="post" class="favorite-form">
                            <input type="hidden" name="postId" th:value="${post.id}">
                            <button type="submit" class="favorite-btn"
                                    th:classappend="${@favoritePostService.isPostInFavorites(session.loggedUser, post) ? 'active' : ''}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                     class="feather feather-heart">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>